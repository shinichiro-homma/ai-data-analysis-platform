# タスク詳細: 3.2 session_list ツール実装

## 概要

MCPツール `session_list` を実装し、アクティブなセッション（カーネル）一覧を取得できるようにする。

このツールにより、ユーザーやAIエージェントが現在起動中のセッションを確認し、適切なセッションを選択して操作できるようになる。

## 関連ドキュメント

- 要件定義: `docs/requirements/jupyter-mcp.md` の「F1.3: セッション一覧」「MCPツール定義 - session_list」セクション
- API仕様: `docs/design/api-contracts.md` の「GET /api/kernels」セクション
- Skill: `.claude/skills/mcp-typescript-server/SKILL.md`

## 実装計画

### 作成するファイル

| ファイル | 内容 |
|----------|------|
| `jupyter-mcp/src/tools/session-list.ts` | session_list ツールの実装 |

### 変更するファイル

| ファイル | 変更内容 |
|----------|------|
| `jupyter-mcp/src/tools/index.ts` | session_list ツールの定義追加とルーティング追加 |

### 実装手順

1. **session-list.ts の作成**
   - `session-create.ts` を参考に、同様の構造で実装
   - `jupyterClient.listKernels()` を呼び出してカーネル一覧を取得
   - 結果を要件定義で定義されたフォーマットで返却

2. **tools/index.ts の更新**
   - ツール定義に `session_list` を追加（inputSchema は空オブジェクト）
   - `handleToolCall` に `session_list` のルーティングを追加
   - import 文に `executeSessionList` を追加

### 技術的な考慮事項

- **既存実装との整合性**: `session-create.ts` と同様のパターンで実装
  - `response-formatter.ts` の `createSuccessResponse`/`createErrorResponse` を使用
  - エラーハンドリングは `extractErrorCode`/`extractErrorMessage` を使用

- **API呼び出し**: `jupyterClient.listKernels()` は既に実装済み（client.ts:80-83）
  - 戻り値: `Kernel[]`（id, name, status, started_at を含む）

- **レスポンスフォーマット**: 要件定義に合わせて以下の形式で返却
  ```json
  {
    "success": true,
    "sessions": [
      {
        "session_id": "kernel-abc123",
        "kernel_id": "kernel-abc123",
        "status": "idle",
        "kernel_name": "python3",
        "created_at": "2024-01-15T10:00:00Z"
      }
    ]
  }
  ```

## 完了条件

- [x] `session_list` ツールが MCP ツール一覧に表示される
- [x] ツール実行時にアクティブなセッション一覧が取得できる
- [x] セッションがない場合は空の配列が返される
- [x] jupyter-server への接続エラー時に適切なエラーメッセージが返される
- [x] TypeScript の型チェックが通る（`npm run typecheck`）

## テスト計画

### 手動テスト

1. **正常系: セッションがある場合**
   - `session_create` でセッションを1つ以上作成
   - `session_list` を実行
   - 作成したセッションが一覧に含まれることを確認

2. **正常系: セッションがない場合**
   - 全セッションを削除（またはjupyter-serverを再起動）
   - `session_list` を実行
   - 空の配列 `[]` が返されることを確認

3. **異常系: jupyter-server 未起動**
   - jupyter-server を停止
   - `session_list` を実行
   - 接続エラーのメッセージが返されることを確認

### MCP Inspector での確認

```bash
cd jupyter-mcp
npm run build
npx @modelcontextprotocol/inspector node dist/index.js
```

- ツール一覧に `session_list` が表示されることを確認
- ツールを実行してレスポンスを確認

---

## レビューステータス

- [x] 計画レビュー完了
- [x] 実装完了
- [x] テスト完了

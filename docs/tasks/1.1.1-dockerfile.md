# タスク詳細: 1.1.1 Dockerfile 作成

## 概要

jupyter-server コンポーネント用の Dockerfile を作成する。jupyter/scipy-notebook をベースイメージとして使用し、データ分析に必要なライブラリをプリインストールした環境を構築する。

## 関連ドキュメント

- 要件定義: `docs/requirements/jupyter-server.md`
  - 「技術仕様」セクション（ベースイメージ、プリインストールライブラリ）
  - 「非機能要件」NF4: 運用性（Dockerコンテナとしてデプロイ）
  - 「環境変数」セクション
  - 「ディレクトリ構成」セクション
- コンポーネント概要: `jupyter-server/CLAUDE.md`

## 実装計画

### 作成するファイル

| ファイル | 内容 |
|----------|------|
| `jupyter-server/Dockerfile` | コンテナイメージ定義 |

### 実装手順

1. **ベースイメージの指定**
   - `jupyter/scipy-notebook:python-3.11` を使用
   - scipy-notebook は pandas, numpy, matplotlib, scipy 等が含まれている

2. **追加ライブラリのインストール**
   - `requirements.txt` をコピーして `pip install -r` でインストール
   - requirements.txt は別タスク（1.1.4）で作成するが、このタスクでは空ファイルを作成してビルドを通す

3. **作業ディレクトリの設定**
   - デフォルトの作業ディレクトリ `/home/jovyan/work` を使用
   - データ用ディレクトリ `/home/jovyan/data` を作成
   - 出力用ディレクトリ `/home/jovyan/output` を作成

4. **設定ファイル配置の準備（コメントアウト）**
   - `jupyter_config/` ディレクトリからの設定ファイルコピーをコメントアウトで記述
   - 実際の設定ファイル作成は別タスク（1.1.3）で行い、その後コメントを解除

5. **ヘルスチェックスクリプト配置の準備（コメントアウト）**
   - `scripts/` ディレクトリからのスクリプトコピーをコメントアウトで記述
   - 実際のスクリプト作成は別タスク（1.1.5）で行い、その後コメントを解除

### 技術的な考慮事項

#### ベースイメージの選択

`jupyter/scipy-notebook:python-3.11` を採用する理由:

- 公式イメージで信頼性が高い
- Python 3.11 + 主要データ分析ライブラリがプリインストール済み
- JupyterLab が設定済み
- 非rootユーザー（jovyan）でセキュリティが考慮されている

#### レイヤー最適化

- `pip install` は1つの RUN 命令にまとめる
- キャッシュを削除してイメージサイズを抑制

#### 後続タスクとの関係

このタスクでは Dockerfile の基本構造のみを作成する。以下は別タスクで対応:

- `jupyter_server_config.py`: タスク 1.1.3
- `healthcheck.sh`: タスク 1.1.5
- `requirements.txt`: タスク 1.1.4（内容を記述）

Dockerfile の対応方針:
- `requirements.txt`: このタスクで空ファイルを作成し、COPY + pip install を有効化。タスク 1.1.4 で内容を記述。
- `jupyter_server_config.py`, `healthcheck.sh`: COPY 命令をコメントアウトで記述。各タスク完了後にコメントを解除。

## 完了条件

- [x] `jupyter-server/Dockerfile` が作成されている
- [x] ベースイメージが `jupyter/scipy-notebook:python-3.11` である
- [x] `requirements.txt` をコピーして pip install する設定になっている
- [x] `jupyter-server/requirements.txt`（空ファイル）が作成されている
- [x] `/home/jovyan/data` と `/home/jovyan/output` ディレクトリが作成される
- [x] 後続タスクで作成するファイル（config, scripts）の COPY 命令がコメントアウトで記述されている
- [x] `docker build` コマンドが成功する（WARNING は許容、ERROR は不可）

## テスト計画

### ビルドテスト

```bash
cd jupyter-server
docker build -t jupyter-server:test .
```

- ビルドが成功することを確認
- エラーが発生しないことを確認

### ベースイメージのライブラリ確認

```bash
docker run --rm jupyter-server:test python -c "import pandas; import numpy; import matplotlib; print('OK')"
```

- ベースイメージに含まれるライブラリがインポートできることを確認
- 注: 追加ライブラリ（polars, plotly 等）はタスク 1.1.4 で requirements.txt を作成後に確認

### ディレクトリ確認

```bash
docker run --rm jupyter-server:test ls -la /home/jovyan/
```

- `data` ディレクトリが存在することを確認
- `output` ディレクトリが存在することを確認

---

## レビューステータス

- [x] 計画レビュー完了
- [x] 実装完了
- [x] テスト完了

# カスタムコマンド一覧

Claude Code で使用できるカスタムコマンドの一覧と使い方。

---

## コマンド一覧

| コマンド | 用途 | 引数 |
|----------|------|------|
| `/custom-status` | 進捗確認 | なし |
| `/custom-plan-task` | タスク計画作成 | タスク番号（例: `1.1.1`） |
| `/custom-start-task` | タスク開始 | タスク番号（例: `1.1.1`） |
| `/custom-complete-task` | タスク完了 | なし |
| `/custom-refactor` | コードのリファクタリング | なし |
| `/custom-change-requirement` | 要件変更の影響調査 | 変更内容の説明 |
| `/custom-apply-change` | 要件変更の適用 | なし |

---

## 通常の開発フロー

### 1. 進捗確認

```
/custom-status
```

現在の開発進捗を確認し、次に着手すべきタスクを把握する。

**出力例:**
- 現在のフェーズ
- 完了タスク数 / 全タスク数
- 進行中のタスク
- 次に着手すべきタスク

### 2. タスク計画作成（新規追加）

```
/custom-plan-task 1.1.1
```

指定したタスクの詳細な開発計画を作成する。

**実行される処理:**
1. タスクに関連する要件定義・API仕様を確認
2. `docs/tasks/{番号}-{タスク名}.md` に計画を作成
3. 実装計画、完了条件、テスト計画を記載
4. **レビュー依頼**（人間が承認するまで実装開始しない）

**作成されるファイル例:** `docs/tasks/1.1.1-dockerfile.md`

### 3. タスク開始

```
/custom-start-task 1.1.1
```

指定したタスクを開始する。

**実行される処理:**
1. **未コミットの変更がないか確認**
2. **計画ファイルが存在し、レビュー済みか確認**
3. `docs/PLAN.md` のステータスを `[→]` に更新
4. 計画に従って実装を開始

### 4. タスク完了

```
/custom-complete-task
```

現在進行中のタスクを完了する。

**実行される処理:**
1. 進行中タスク（`[→]`）を確認
2. 成果物の確認（要件を満たしているか、テストがあるか）
3. `docs/PLAN.md` のステータスを `[x]` に更新
4. **変更をコミット**（`feat: タスク X.X.X {タスク名} 完了`）
5. 次のタスクを提案

---

## 要件変更フロー

要件を変更する場合は、2段階で進める。

### 1. 影響調査

```
/custom-change-requirement セッション管理にタイムアウト機能を追加
```

変更内容を引数に渡すと、影響範囲を洗い出す。

**実行される処理:**
1. `CLAUDE.md` の「ドキュメント構成マップ」を確認
2. 変更種別を特定（MCPツール追加、API変更など）
3. 依存関係表に基づいて影響ファイルを特定
4. 各ファイルを開いて具体的な影響箇所を確認
5. **確認を求める（この時点ではファイルを変更しない）**

**確認対象ファイル:**
- `CLAUDE.md`（ルート）- コンポーネント表
- `docs/overview.md` - アーキテクチャ、ツール/API一覧表
- `docs/requirements/*.md` - 機能要件、スキーマ定義
- `docs/design/api-contracts.md` - API仕様
- `*/CLAUDE.md` - コンポーネント概要
- `docs/PLAN.md` - タスク一覧

### 2. 変更適用

```
/custom-apply-change
```

確認後、実際に変更を適用する。

**実行される処理:**
1. 影響箇所に変更を適用（順序を守る）
   - 要件定義 → API仕様 → 全体像 → コンポーネントCLAUDE.md → PLAN.md
2. 整合性を確認
   - ツール/API名の一致
   - 入出力スキーマの一致
   - タスクの網羅性
3. `docs/PLAN.md` の変更履歴に記録
4. **変更をコミット**（`docs: {変更内容の要約}`）
5. 変更したファイル一覧と整合性確認結果を報告

---

## 使用例

### 例1: 新しいタスクに着手する

```
> /custom-status

現在のフェーズ: Phase 1 - Jupyter環境構築
完了: 2/16
進行中: なし
次のタスク: 1.1.3 jupyter_server_config.py 作成

> /custom-plan-task 1.1.3

タスク 1.1.3 の計画を作成しました。

詳細ファイル: docs/tasks/1.1.3-jupyter-server-config.md

### 概要
JupyterLabの設定ファイルを作成し、トークン認証とCORS設定を行う。

### 実装計画
1. jupyter_server_config.py を作成
2. トークン認証の設定
3. CORS設定（開発環境用）

### 確認事項
- トークンは環境変数から取得でよいか
- CORS設定は開発環境のみでよいか

---
この計画でよろしければ、`/custom-start-task 1.1.3` で実装を開始できます。

> （レビューして）OK、進めてください

> /custom-start-task 1.1.3

タスク 1.1.3 を開始します。
計画ファイル: docs/tasks/1.1.3-jupyter-server-config.md
docs/PLAN.md を更新しました。

計画に従って実装を開始します。

（実装作業...）

> /custom-complete-task

タスク 1.1.3 を完了しました。
docs/PLAN.md を更新しました。
コミット: feat: タスク 1.1.3 jupyter_server_config.py作成 完了

次のタスク候補:
- 1.1.4 requirements.txt 作成
```

### 例2: 要件を変更する

```
> /custom-change-requirement execute_code にストリーミング出力機能を追加

影響範囲を調査しました。

影響を受けるファイル:
1. docs/requirements/jupyter-mcp.md
   - F2.1 コード実行の要件を更新
   - execute_code ツールの戻り値にストリーミング対応を追加
   
2. docs/design/api-contracts.md
   - POST /api/kernels/{id}/execute のレスポンス形式を更新

3. docs/PLAN.md
   - タスク 1.2.4 の備考を更新

この変更を適用してよろしいですか？

> はい

> /custom-apply-change

変更を適用しました。

変更したファイル:
- docs/requirements/jupyter-mcp.md
- docs/design/api-contracts.md
- docs/PLAN.md（変更履歴に記録）
```

---

## 注意事項

- `/custom-start-task` を実行する前に、前のタスクが完了していることを確認してください
- 要件変更時は必ず `/custom-change-requirement` で影響調査を行ってから適用してください
- 複数タスクを同時に進めないでください（1タスク1機能）
- タスク完了後やキリの良いタイミングで `/custom-refactor` を実行してコード品質を維持してください

---

## リファクタリング

### コードのリファクタリング

```
/custom-refactor
```

直近で実装したコードをリファクタリングする。

**実行タイミング:**
- タスク完了後
- 複数タスクが完了した区切りのタイミング
- コードの品質が気になったとき

**チェックする観点（優先度順）:**
1. コードの重複排除
2. 命名の改善
3. エラーハンドリングの統一
4. 責務の分離（ファイル/関数の分割）
5. 型定義の整理

**実行される処理:**
1. 対象ファイルの特定（直近の変更）
2. 各観点でレビュー
3. 問題の修正
4. 動作確認（typecheck, test）
5. コミット（`refactor: ...`）
